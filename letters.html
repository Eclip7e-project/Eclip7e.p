<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Letters and Notes</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }

    h1 {
      text-align: center;
    }

    .note-card {
      background: #222;
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      position: relative;
      overflow-wrap: break-word;
      word-break: break-word;
    }

    .note-card img {
      max-width: 100%;
      border-radius: 8px;
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
    }

    textarea {
      width: 100%;
      height: 120px;
      background: #111;
      color: white;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 10px;
      resize: none;
    }

    input[type="color"] {
      margin-top: 5px;
      width: 60px;
      height: 35px;
      border: none;
      border-radius: 6px;
    }

    .btn {
      background: #444;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 15px;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn:hover {
      background: #666;
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Letters and Notes</h1>

    <button class="btn" id="new-note-btn">New Note</button>
    <button class="btn" id="new-letter-btn">New Letter</button>

    <div id="notes-list"></div>
  </div>

  <!-- Modal -->
  <div id="note-modal" class="modal">
    <div class="modal-content">
      <h3 id="modal-title">Create Note</h3>

      <!-- Note fields -->
      <div id="note-fields">
        <label>Text color</label>
        <input id="note-color-picker" type="color" value="#ffffff">
        <label style="margin-top:10px;">Write your note (max 300 chars)</label>
        <textarea id="note-text" maxlength="300" placeholder="Write your message (max 300 chars)"></textarea>
      </div>

      <!-- Letter fields -->
      <div id="letter-fields" style="display:none;">
        <label>Text color</label>
        <input id="letter-color-picker" type="color" value="#ffffff">
        <label style="margin-top:10px;">Write your letter (max 2000 chars)</label>
        <textarea id="letter-text" maxlength="2000" placeholder="Write your letter (max 2000 chars)"></textarea>
      </div>

      <div class="modal-actions">
        <button class="btn btn-cancel" id="modal-cancel">Cancel</button>
        <button class="btn btn-submit" id="modal-submit">Submit</button>
      </div>
    </div>
  </div>

  <script type="module">
    // ðŸ”¥ Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    // âœ… Your Firebase Config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Simulated logged-in user
    const userId = "cris_owner_001"; // admin for now
    const username = "Admin";

    // Elements
    const modal = document.getElementById("note-modal");
    const modalTitle = document.getElementById("modal-title");
    const modalSubmit = document.getElementById("modal-submit");
    const modalCancel = document.getElementById("modal-cancel");
    const notesList = document.getElementById("notes-list");
    const noteText = document.getElementById("note-text");
    const noteColor = document.getElementById("note-color-picker");
    const letterText = document.getElementById("letter-text");
    const letterColor = document.getElementById("letter-color-picker");
    const noteFields = document.getElementById("note-fields");
    const letterFields = document.getElementById("letter-fields");

    let currentType = "note";

    // ðŸŸ¢ Open modal for note or letter
    document.getElementById("new-note-btn").onclick = () => {
      currentType = "note";
      modalTitle.textContent = "Create Note";
      noteFields.style.display = "block";
      letterFields.style.display = "none";
      modal.style.display = "flex";
    };

    document.getElementById("new-letter-btn").onclick = () => {
      currentType = "letter";
      modalTitle.textContent = "Create Letter";
      noteFields.style.display = "none";
      letterFields.style.display = "block";
      modal.style.display = "flex";
    };

    modalCancel.onclick = () => modal.style.display = "none";

    // ðŸŸ¢ Submit note/letter
    modalSubmit.onclick = async () => {
      const text = currentType === "note" ? noteText.value.trim() : letterText.value.trim();
      const color = currentType === "note" ? noteColor.value : letterColor.value;

      if (!text) {
        alert("Please write something!");
        return;
      }

      try {
        await addDoc(collection(db, "notes", currentType === "note" ? "member" : "letters", "memberNotes"), {
          text,
          color,
          creator: userId,
          username: username,
          type: currentType,
          createdAt: new Date()
        });
        modal.style.display = "none";
        noteText.value = "";
        letterText.value = "";
      } catch (e) {
        console.error("Error adding document: ", e);
      }
    };

    // ðŸŸ£ Real-time listener
    const q = collection(db, "notes", "member", "memberNotes");
    onSnapshot(q, (snapshot) => {
      notesList.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.className = "note-card";
        div.style.color = data.color;
        div.innerHTML = `
          <p>${data.text}</p>
          <p style="font-size:12px;opacity:0.6;">By: ${data.username || "Unknown"}</p>
          ${(userId === data.creator || userId === "cris_owner_001") ? 
            `<button class="btn btn-delete" data-id="${docSnap.id}">Delete</button>` : ""}
        `;
        notesList.appendChild(div);
      });

      document.querySelectorAll(".btn-delete").forEach(btn => {
        btn.onclick = async () => {
          const id = btn.getAttribute("data-id");
          await deleteDoc(doc(db, "notes", "member", "memberNotes", id));
        };
      });
    });
  </script>
</body>
</html>
